# 产品需求文档 (PRD)
# Knowledge Studio - AI 对话知识管理平台

**文档版本**: v2.0
**创建日期**: 2025-10-26
**更新日期**: 2025-10-26
**产品负责人**: [待填写]
**目标发布日期**: V1.0 - 3个月内

---

## 📋 目录

1. [产品概述](#1-产品概述)
2. [目标用户](#2-目标用户)
3. [核心价值主张](#3-核心价值主张)
4. [产品架构](#4-产品架构)
5. [功能需求](#5-功能需求)
6. [用户故事](#6-用户故事)
7. [非功能需求](#7-非功能需求)
8. [技术架构](#8-技术架构)
9. [里程碑与路线图](#9-里程碑与路线图)
10. [成功指标](#10-成功指标)
11. [风险与依赖](#11-风险与依赖)

---

## 1. 产品概述

### 1.1 产品定义

Knowledge Studio 是一个**集成多模型的 AI 对话客户端 + 知识管理平台**，让用户在统一界面中使用多个 LLM（GPT-4、Claude、Gemini 等），同时**自动将对话转化为结构化知识库**，支持团队协作和知识拓扑分析。

**产品定位**：
- **不是** 简单的对话采集工具
- **不是** 浏览器扩展
- **是** 一个原生的 AI 对话客户端（类似 Cherry Studio / ChatBox）
- **是** 一个知识管理和协作平台

### 1.2 产品愿景

> 成为知识工作者的 AI 助手中心，让每一次对话都成为团队的知识资产，通过知识拓扑激发创新。

### 1.3 问题陈述

**当前痛点**:

1. **多平台切换繁琐**
   - 需要在 ChatGPT、Claude、Gemini 等多个网站间切换
   - 每个平台都需要单独登录和付费
   - 对话历史分散在各个平台

2. **知识无法沉淀**
   - 对话结束后很难再找到有价值的内容
   - 无法有效组织和分类对话
   - 知识碎片化，无法形成体系

3. **缺乏知识关联**
   - 相关对话之间没有连接
   - 无法看到知识的演进过程
   - 难以发现知识之间的关系

4. **团队协作困难**
   - 个人的 AI 对话知识无法共享给团队
   - 团队成员重复询问相同问题
   - 缺乏知识复用机制

**解决方案**:

Knowledge Studio 提供：
- ✅ **统一的多模型对话界面** - 一个客户端调用所有 LLM
- ✅ **自动知识组织** - 对话自动分类、标签、归档
- ✅ **知识拓扑图谱** - 可视化知识关联和演进
- ✅ **团队协作空间** - 知识共享和协作讨论

### 1.4 产品范围

#### V1.0 范围（桌面客户端）

**在范围内**:
- ✅ 桌面应用（Mac / Windows）
- ✅ 多模型集成（OpenAI、Anthropic、Google 等）
- ✅ 用户自带 API Key
- ✅ 对话自动保存和组织
- ✅ 项目/文件夹/标签管理
- ✅ 全文搜索
- ✅ 本地数据存储 + 可选云同步
- ✅ 基础团队协作（共享知识库）
- ✅ 知识导出（Markdown/JSON）

**不在范围内**:
- ❌ Web 版本（V2.0）
- ❌ 平台统一调用和计费（V2.0）
- ❌ 移动端 App
- ❌ 高级知识图谱（V1.5）
- ❌ AI 自动摘要和总结（V1.5）
- ❌ 实时协作编辑

#### V2.0 展望（Web + SaaS）

- ✅ Web 平台版本
- ✅ 平台统一调用 API（用户无需自备 Key）
- ✅ 订阅制收费模式
- ✅ 更强的团队协作功能
- ✅ 企业级权限管理

---

## 2. 目标用户

### 2.1 主要用户画像

#### Persona 1: 独立开发者 / 技术专家 - 张强

**基本信息**:
- 年龄: 30岁
- 职业: 全栈工程师 / 技术 Lead
- 使用场景: 代码调试、架构设计、技术学习
- AI 使用频率: 每天 10+ 次对话

**当前困境**:
- "我同时订阅了 ChatGPT Plus 和 Claude Pro，但每次要切换网站很麻烦"
- "上周问过的技术问题，今天又想不起来了，要重新问一遍"
- "想把一些经典的技术方案整理成知识库，但手动整理太费时间"

**使用目标**:
- 在一个客户端内使用多个 AI 模型
- 自动保存和分类技术对话
- 快速检索历史解决方案
- 建立个人技术知识库

**期望价值**:
- 节省 50% 的模型切换时间
- 减少 80% 的重复提问
- 建立系统化的技术知识体系

#### Persona 2: 产品经理 / 研究员 - 李敏

**基本信息**:
- 年龄: 28岁
- 职业: 产品经理 / 用户研究员
- 使用场景: 需求分析、竞品研究、用户洞察
- AI 使用频率: 每天 15+ 次对话

**当前困境**:
- "用 AI 做竞品分析时，多个对话之间有关联，但很难追踪"
- "想把产品灵感和用户洞察整理成知识图谱，但现有工具做不到"
- "团队其他成员也在用 AI 做研究，但我们的知识无法共享"

**使用目标**:
- 多维度组织产品和研究对话
- 可视化知识之间的关联
- 与团队共享研究成果
- 追踪想法的演进过程

**期望价值**:
- 建立结构化的产品知识库
- 发现知识之间的隐藏联系
- 提升团队研究效率 30%

#### Persona 3: 内容创作者 / 知识工作者 - 王芳

**基本信息**:
- 年龄: 26岁
- 职业: 内容创作者 / 自媒体运营
- 使用场景: 选题策划、文案创作、素材收集
- AI 使用频率: 每天 20+ 次对话

**当前困境**:
- "创意和灵感太多，ChatGPT 的文件夹功能不够用"
- "想按主题整理创作素材，还要能看到主题之间的关系"
- "有时候想不起来某个好点子在哪个对话里，找不到"

**使用目标**:
- 精细化管理创意和素材
- 按主题/项目组织内容
- 快速检索历史灵感
- 追踪创意的演变

**期望价值**:
- 零丢失的灵感管理
- 系统化的创作素材库
- 提高创作效率 40%

### 2.2 目标市场

**主要市场**:
- 🎯 技术工作者（开发者、设计师、产品经理）
- 🎯 知识工作者（研究员、分析师、咨询师）
- 🎯 内容创作者（写作者、运营、教育工作者）

**市场规模**:
- TAM (Total Addressable Market): 全球 AI 工具用户 2亿+
- SAM (Serviceable Available Market): 深度 AI 用户 + 知识管理需求 2000万+
- SOM (Serviceable Obtainable Market): V1.0 目标 1万用户

---

## 3. 核心价值主张

### 3.1 五大核心优势

#### 1. 多模型整合（类似 Cherry Studio）

**价值**:
- 一个客户端管理所有 LLM
- 随时切换最适合的模型
- 对比不同模型的回答

**实现**:
- 支持 OpenAI (GPT-4, GPT-3.5)
- 支持 Anthropic (Claude 3.5, Claude 3)
- 支持 Google (Gemini Pro, Gemini Ultra)
- 支持 Ollama (本地模型)
- 统一的对话界面
- 一键切换模型

**量化指标**: 减少 60% 的平台切换时间

#### 2. 知识收集和组织

**价值**:
- 对话自动保存，永不丢失
- 灵活的分类和标签系统
- 强大的搜索和筛选

**实现**:
- 对话自动保存到本地数据库
- 多级项目/文件夹结构
- 自定义标签系统
- 全文搜索 + 语义搜索
- 高级筛选（时间、模型、标签等）
- 收藏和星标

**量化指标**: 知识检索效率提升 5倍

#### 3. 知识深度探索和理解追踪 🌟 **核心差异化**

**价值**:
- 标注和追踪不理解的知识点
- 针对难点进行深度探索
- 从碎片到体系的知识构建
- AI 辅助生成主题知识图谱

**核心场景**:
> 用户在学习复杂技术或概念时，AI 的回答中可能包含多个陌生的知识点。用户可以在阅读过程中标注"暂不理解"的部分，系统帮助用户针对这些知识点进行深度探索，最终将所有相关对话整合成一个完整的主题知识库。

**实现**:

1. **知识点标注**（V1.0）:
   - 选中 AI 回复的任意文本，右键"标记为知识点"
   - 标记理解状态：❓ 不理解 / ⚠️ 部分理解 / ✅ 已掌握
   - 为知识点添加笔记和疑问
   - 一键发起针对该知识点的新对话

2. **深度探索链**（V1.0）:
   - 从知识点直接发起"深入解释"对话
   - 自动关联父子对话（原始对话 → 深度探索对话）
   - 形成知识探索树（一个主题 → 多层次探索）
   - 可视化知识理解进度

3. **主题知识库**（V1.5）:
   - 将相关对话归集到"主题知识库"
   - 主题包含：原始对话、探索对话、标注的知识点、个人笔记
   - 知识点理解状态追踪
   - 导出为结构化文档

4. **AI 生成知识图谱**（V1.5）:
   - 基于主题内所有对话，AI 自动分析知识点关联
   - 生成可交互的知识图谱
   - 节点：核心概念和知识点
   - 边：知识点之间的关系（依赖、并列、对比等）
   - 颜色编码：理解状态（已掌握/学习中/未掌握）

**UI 示例**:
```
对话中标注知识点:
┌─────────────────────────────────────────┐
│ 🤖 GPT-4:                               │
│ React 性能优化主要有以下方向:           │
│                                         │
│ 1. 使用 【React.memo()】❓              │
│    可以避免不必要的组件重渲染           │
│                                         │
│ 2. 使用 【useMemo 和 useCallback】⚠️    │
│    缓存计算结果和函数引用               │
│                                         │
│ 3. 【虚拟列表】❓                       │
│    处理大量数据时的必备优化             │
│                                         │
│ [💡 对话中有 3 个标注的知识点]          │
│ [📊 查看知识图谱]                       │
└─────────────────────────────────────────┘

知识点详情面板:
┌─────────────────────────────────────────┐
│ 📍 知识点: React.memo()                 │
│ 状态: ❓ 不理解                         │
│                                         │
│ 💬 我的疑问:                            │
│ "memo 和 useMemo 有什么区别？"          │
│                                         │
│ 📖 相关对话: 2 个                       │
│ - React 性能优化完整指南                │
│ - React.memo() 深度解析                 │
│                                         │
│ [🔍 深入探索]  [✏️ 添加笔记]  [✅ 标记已掌握]│
└─────────────────────────────────────────┘

主题知识库视图:
┌─────────────────────────────────────────┐
│ 📚 主题: React 性能优化                 │
│                                         │
│ 📊 学习进度: 65%                        │
│ ✅ 已掌握: 8  ⚠️ 学习中: 3  ❓ 待学习: 1│
│                                         │
│ 📖 包含对话: 5 个                       │
│ 📍 标注知识点: 12 个                    │
│ 🔗 知识关联: 18 条                      │
│                                         │
│ [📊 查看知识图谱]  [📄 生成学习文档]    │
│ [🤖 AI 总结]  [📤 导出]                 │
└─────────────────────────────────────────┘

AI 生成的知识图谱:
┌─────────────────────────────────────────┐
│         React 性能优化                  │
│              │                          │
│      ┌───────┴────────┐                │
│      │                │                │
│   组件优化          列表优化            │
│      │                │                │
│  ┌───┴───┐        ┌───┴───┐           │
│  │       │        │       │           │
│ memo  useMemo  虚拟列表  分页          │
│ ✅     ⚠️       ❓      ✅             │
│                                         │
│ [双击节点查看详情]  [点击边查看关系]    │
└─────────────────────────────────────────┘
```

**量化指标**:
- 知识掌握效率提升 3倍
- 学习主题完成度提高 80%
- 知识遗忘率降低 60%

#### 4. 知识整理和拓扑

**价值**:
- 可视化知识关联
- 发现隐藏的知识联系
- 追踪想法演进过程

**实现** (V1.5):
- 跨对话知识图谱可视化
- 自动发现相关对话
- 手动建立对话链接
- 时间线视图（追踪演进）
- 主题聚类分析

**量化指标**: 知识复用率提升 40%

#### 5. 团队协作

**价值**:
- 团队知识共享
- 避免重复提问
- 协作讨论和注释

**实现**:
- 团队工作空间
- 共享知识库
- 对话分享和讨论
- @提及和通知
- 权限管理

**量化指标**: 团队重复提问减少 50%

### 3.2 差异化竞争

| 对比维度 | ChatGPT官方 | Cherry Studio | Notion AI | Obsidian | **Knowledge Studio** |
|---------|-------------|---------------|-----------|----------|---------------------|
| **多模型集成** | ❌ 仅 OpenAI | ✅ 多模型 | ❌ 仅 Notion AI | ⚠️ 需插件 | ✅ 原生多模型 |
| **知识组织** | ⚠️ 基础文件夹 | ⚠️ 基础分类 | ✅ 强大 | ✅✅ 最强 | ✅✅ AI对话专门优化 |
| **知识点标注** | ❌ 无 | ❌ 无 | ⚠️ 基础高亮 | ✅ 双向链接 | ✅✅ 理解状态追踪 |
| **深度探索** | ❌ 无 | ❌ 无 | ❌ 无 | ⚠️ 手动链接 | ✅ 自动关联探索链 |
| **知识图谱** | ❌ 无 | ❌ 无 | ❌ 无 | ⚠️ 基础图谱 | ✅ AI生成主题图谱 |
| **学习进度追踪** | ❌ 无 | ❌ 无 | ❌ 无 | ❌ 无 | ✅ 理解状态可视化 |
| **团队协作** | ❌ 无 | ❌ 无 | ✅ 有 | ⚠️ 第三方 | ✅ 专门设计 |
| **本地优先** | ❌ 云端 | ✅ 本地 | ❌ 云端 | ✅ 本地 | ✅ 本地+云同步 |
| **价格** | $20/月 | 免费 | $10/月 | $8/月 | 免费(V1) |

**我们的独特定位**:
> 第一款专为 **AI 对话学习场景** 设计的知识管理系统，将"多模型 AI 客户端"、"知识理解追踪"、"深度探索链"、"AI 知识图谱生成"深度融合，帮助用户将碎片化的 AI 对话转化为结构化、体系化的个人/团队知识库。

**核心创新**:
- 🌟 **从不理解到掌握的完整闭环**: 标注 → 探索 → 理解 → 掌握
- 🌟 **AI 辅助知识体系构建**: 自动生成主题知识图谱
- 🌟 **学习型知识库**: 不仅保存对话，更追踪知识的理解和掌握过程

---

## 4. 产品架构

### 4.1 产品形态演进

```
V1.0 (3个月)              V1.5 (6个月)              V2.0 (12个月)
桌面客户端                增强版                     Web + SaaS
─────────────────────────────────────────────────────────────
│ 本地优先               │ + 知识图谱                │ + Web 平台
│ 用户自带 API Key       │ + AI 摘要                 │ + 平台统一调用
│ 基础知识管理           │ + 语义搜索                │ + 订阅制
│ 本地 + 可选云同步      │ + 高级协作                │ + 企业功能
│                         │                           │
└─ Mac / Windows         └─ + Linux                  └─ + 浏览器访问
```

### 4.2 核心架构（V1.0）

```
┌─────────────────────────────────────────────────────┐
│                   桌面应用 (Tauri)                   │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌──────────────┐      ┌──────────────────────┐   │
│  │  AI 对话界面  │      │   知识管理界面        │   │
│  │              │      │                      │   │
│  │ - 多模型切换  │      │ - 项目/文件夹        │   │
│  │ - 对话输入    │      │ - 标签管理           │   │
│  │ - 流式输出    │      │ - 搜索筛选           │   │
│  │ - 上下文管理  │      │ - 对话详情           │   │
│  └──────────────┘      └──────────────────────┘   │
│           │                      │                 │
│  ┌────────┴──────────────────────┴────────┐       │
│  │         核心业务逻辑 (Rust/TS)          │       │
│  │                                         │       │
│  │ - 对话管理  - 知识组织  - 数据同步      │       │
│  └─────────────────────────────────────────┘       │
│           │                                        │
│  ┌────────┴────────┐         ┌─────────────┐      │
│  │  本地存储        │         │  AI SDK     │      │
│  │  (SQLite)       │         │  集成层      │      │
│  └─────────────────┘         └─────────────┘      │
│           │                         │              │
└───────────┼─────────────────────────┼──────────────┘
            │                         │
    ┌───────┴────────┐       ┌────────┴────────┐
    │  云同步服务     │       │  LLM API        │
    │  (可选)        │       │  - OpenAI       │
    └────────────────┘       │  - Anthropic    │
                             │  - Google       │
                             │  - Ollama       │
                             └─────────────────┘
```

### 4.3 数据架构

**本地优先 (Local-First)**:
- 所有数据优先存储在本地 SQLite
- 可选开启云同步（加密后同步）
- 离线完全可用

**云同步（可选）**:
- 端到端加密
- 仅同步数据库增量
- 支持多设备同步

---

## 5. 功能需求

### 5.1 功能优先级矩阵

| 功能模块 | 优先级 | V1.0 (3月) | V1.5 (6月) | V2.0 (12月) |
|---------|--------|-----------|-----------|------------|
| **AI 对话** |
| 多模型集成 | P0 | ✅ | ✅ | ✅ |
| 对话界面 | P0 | ✅ | ✅ | ✅ |
| 流式输出 | P0 | ✅ | ✅ | ✅ |
| 上下文管理 | P0 | ✅ | ✅ | ✅ |
| API Key 管理 | P0 | ✅ | ✅ | ⚠️ (可选) |
| Prompt 模板 | P1 | ✅ | ✅ | ✅ |
| 对话分支 | P1 | ❌ | ✅ | ✅ |
| **知识管理** |
| 自动保存对话 | P0 | ✅ | ✅ | ✅ |
| 项目/文件夹 | P0 | ✅ | ✅ | ✅ |
| 标签系统 | P0 | ✅ | ✅ | ✅ |
| 全文搜索 | P0 | ✅ | ✅ | ✅ |
| 高级筛选 | P0 | ✅ | ✅ | ✅ |
| 收藏星标 | P0 | ✅ | ✅ | ✅ |
| 语义搜索 | P1 | ❌ | ✅ | ✅ |
| 批量操作 | P1 | ❌ | ✅ | ✅ |
| **知识深度探索** 🌟 |
| 知识点标注 | P0 | ✅ | ✅ | ✅ |
| 理解状态追踪 | P0 | ✅ | ✅ | ✅ |
| 深度探索对话 | P0 | ✅ | ✅ | ✅ |
| 主题知识库 | P1 | ❌ | ✅ | ✅ |
| AI 生成知识图谱 | P1 | ❌ | ✅ | ✅ |
| 学习进度可视化 | P1 | ❌ | ✅ | ✅ |
| **知识拓扑** |
| 对话链接 | P1 | ❌ | ✅ | ✅ |
| 跨主题知识图谱 | P1 | ❌ | ✅ | ✅ |
| 相关推荐 | P1 | ❌ | ✅ | ✅ |
| AI 自动摘要 | P1 | ❌ | ✅ | ✅ |
| 主题聚类 | P2 | ❌ | ❌ | ✅ |
| **团队协作** |
| 团队空间 | P0 | ✅ | ✅ | ✅ |
| 知识库共享 | P0 | ✅ | ✅ | ✅ |
| 成员管理 | P0 | ✅ | ✅ | ✅ |
| 对话分享 | P0 | ✅ | ✅ | ✅ |
| 评论讨论 | P1 | ❌ | ✅ | ✅ |
| @提及通知 | P1 | ❌ | ✅ | ✅ |
| 权限控制 | P1 | ⚠️ 基础 | ✅ | ✅ |
| **其他功能** |
| 导出 (MD/JSON) | P0 | ✅ | ✅ | ✅ |
| 导入历史对话 | P1 | ✅ | ✅ | ✅ |
| 云同步 | P1 | ✅ | ✅ | ✅ |
| 主题切换 | P1 | ✅ | ✅ | ✅ |
| 快捷键 | P1 | ✅ | ✅ | ✅ |

### 5.2 V1.0 核心功能详细说明

#### 5.2.1 AI 对话模块

##### Feature 1: 多模型集成

**功能描述**:
用户可以在统一界面中使用多个 LLM，随时切换模型。

**支持的模型**:

| 提供商 | 模型 | V1.0支持 |
|-------|------|---------|
| OpenAI | GPT-4, GPT-4-Turbo, GPT-3.5-Turbo | ✅ |
| Anthropic | Claude 3.5 Sonnet, Claude 3 Opus, Claude 3 Haiku | ✅ |
| Google | Gemini 1.5 Pro, Gemini 1.5 Flash | ✅ |
| Ollama | Llama 3, Mistral, 自定义模型 | ✅ |
| Moonshot | moonshot-v1 | ⚠️ 可选 |
| 智谱 AI | glm-4 | ⚠️ 可选 |

**核心交互**:
```
┌─────────────────────────────────────────┐
│  [模型选择] GPT-4 ▼      [新对话] [⚙️]   │
├─────────────────────────────────────────┤
│                                         │
│  👤 用户:                               │
│  帮我写一个 React 组件...               │
│                                         │
│  🤖 GPT-4:                              │
│  当然，我来帮你写一个 React 组件...      │
│  ```jsx                                 │
│  ...                                    │
│                                         │
│  [💾 保存到项目]  [🔗 链接到对话]  [⭐]   │
│                                         │
├─────────────────────────────────────────┤
│  [输入框]                               │
│  你的问题...                            │
│  [📎] [发送]   [切换到 Claude 3.5 ▼]    │
└─────────────────────────────────────────┘
```

**技术实现**:
- 统一的 LLM SDK 抽象层
- 支持流式输出 (SSE)
- 自动重试和错误处理
- Token 计数和成本估算

**配置管理**:
```typescript
interface ModelConfig {
  provider: 'openai' | 'anthropic' | 'google' | 'ollama';
  modelId: string;
  apiKey: string;
  baseURL?: string; // 支持自定义端点
  maxTokens?: number;
  temperature?: number;
  topP?: number;
}
```

##### Feature 2: 对话界面

**布局设计**:

```
┌─────────────────────────────────────────────────────────────┐
│  [≡] Knowledge Studio           [@团队] [☁️已同步] [⚙️]     │
├──────────┬──────────────────────────────────────────────────┤
│          │  [新对话]  [模型: GPT-4 ▼]  [Prompt 模板 ▼]      │
│  📁 项目  │                                                  │
│   技术   │  ┌────────────────────────────────────────────┐  │
│   产品   │  │ 👤 用户 (12:30)                           │  │
│   创意   │  │ 如何优化 React 性能?                       │  │
│          │  └────────────────────────────────────────────┘  │
│  🏷️ 标签  │                                                  │
│   React  │  ┌────────────────────────────────────────────┐  │
│   Python │  │ 🤖 GPT-4 (12:30)                          │  │
│   设计   │  │ React 性能优化有以下几个方向:              │  │
│          │  │ 1. 使用 React.memo()...                   │  │
│  ⭐ 收藏  │  │ 2. 避免不必要的重渲染...                  │  │
│  🕐 最近  │  └────────────────────────────────────────────┘  │
│  👥 团队  │                                                  │
│          │  ┌────────────────────────────────────────────┐  │
│          │  │ 输入框                                    │  │
│          │  │ 继续提问...                               │  │
│          │  │                                           │  │
│          │  │ [📎附件] [发送 ⏎]   Token: 1234/4096     │  │
│          │  └────────────────────────────────────────────┘  │
├──────────┴──────────────────────────────────────────────────┤
│  [🔍 搜索]  [📊 知识图谱]  [⚙️ 设置]                        │
└─────────────────────────────────────────────────────────────┘
```

**核心功能点**:
1. **左侧边栏**: 项目、标签、收藏、最近、团队导航
2. **中间主区**: 对话历史和输入
3. **顶部操作栏**: 新对话、模型选择、Prompt 模板
4. **底部状态栏**: 搜索、知识图谱、设置入口

**对话体验**:
- ✅ Markdown 渲染（代码高亮）
- ✅ 流式输出动画
- ✅ 复制代码块
- ✅ 重新生成回答
- ✅ 编辑用户消息
- ✅ Token 计数显示
- ✅ 成本估算

##### Feature 3: Prompt 模板

**功能描述**:
用户可以创建和管理常用的 Prompt 模板，快速开始对话。

**模板示例**:
```
📋 代码审查助手
You are an expert code reviewer. Please review the following code and provide feedback on:
- Code quality
- Potential bugs
- Performance issues
- Best practices

Code:
{{CODE}}

📋 产品需求分析
作为产品经理，请帮我分析以下需求:
{{REQUIREMENT}}

请从以下角度分析:
1. 用户价值
2. 技术可行性
3. 优先级建议
```

**模板管理**:
- 创建/编辑/删除模板
- 变量占位符 `{{VAR_NAME}}`
- 分类和标签
- 团队共享模板

##### Feature 4: 上下文管理

**功能描述**:
管理对话的上下文长度，优化成本和性能。

**策略**:
1. **自动策略**: 保留最近 N 条消息
2. **手动选择**: 用户勾选要包含的消息
3. **智能压缩**: 自动总结早期对话（V1.5）

**UI 交互**:
```
上下文设置:
┌────────────────────────┐
│ ⚙️ 上下文策略           │
├────────────────────────┤
│ ○ 全部消息             │
│ ● 最近 10 条           │
│ ○ 手动选择             │
│ ○ 智能压缩 (V1.5)      │
├────────────────────────┤
│ 当前: 8 消息 / 2.3k tokens │
│ 预估成本: $0.0046      │
└────────────────────────┘
```

#### 5.2.2 知识管理模块

##### Feature 5: 自动保存对话

**功能描述**:
所有对话自动保存到本地数据库，无需手动操作。

**保存时机**:
- 实时保存每条消息
- 对话结束时自动归档
- 异常退出自动恢复

**元数据**:
```typescript
interface Conversation {
  id: string;
  title: string; // 自动生成或用户编辑
  messages: Message[];
  model: string; // 使用的模型
  createdAt: Date;
  updatedAt: Date;
  projectId?: string;
  tags: string[];
  isFavorite: boolean;
  isArchived: boolean;

  // 统计数据
  stats: {
    messageCount: number;
    totalTokens: number;
    estimatedCost: number;
  };

  // 知识关联
  linkedConversations?: string[]; // V1.5
}

interface Message {
  id: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: Date;
  model?: string;

  // Token 统计
  tokens?: number;

  // 附件
  attachments?: Attachment[];
}
```

**自动标题生成**:
- 基于第一条用户消息
- 用户可随时编辑
- 支持模板自定义

##### Feature 6: 项目/文件夹管理

**功能描述**:
多级项目和文件夹结构，灵活组织对话。

**层级结构**:
```
📁 工作
  📁 项目A
    📁 需求分析
    📁 技术设计
  📁 项目B
📁 学习
  📁 React
  📁 Python
📁 个人
  📁 创意想法
```

**操作**:
- 创建/重命名/删除项目
- 拖拽移动对话
- 项目颜色和图标
- 项目描述和封面

**UI 设计**:
```
项目卡片:
┌──────────────────────┐
│ 🎯 项目名称           │
│ 描述...              │
├──────────────────────┤
│ 📊 45 对话           │
│ 🕐 最近: 2小时前     │
│ 👥 3 成员            │
└──────────────────────┘
```

##### Feature 7: 标签系统

**功能描述**:
自定义标签，多维度分类对话。

**标签特性**:
- 自定义名称和颜色
- 一个对话可有多个标签
- 标签云展示（按频率）
- 标签管理（重命名、合并、删除）

**智能标签** (V1.5):
- AI 自动打标签
- 基于内容的标签推荐

**UI 示例**:
```
标签选择:
┌────────────────────────────┐
│ 常用标签:                  │
│ [React] [Python] [设计]    │
│                            │
│ 所有标签:                  │
│ [React 23] [Python 15]     │
│ [设计 8] [产品 12]         │
│                            │
│ + 新建标签                 │
└────────────────────────────┘
```

##### Feature 8: 搜索与筛选

**搜索功能**:

1. **全文搜索**:
   - 搜索对话标题和内容
   - 高亮匹配关键词
   - 实时搜索建议
   - 支持中英文

2. **高级筛选**:
   ```
   筛选条件:
   ┌─────────────────────┐
   │ 🤖 模型              │
   │ ☑️ GPT-4            │
   │ ☑️ Claude 3.5       │
   │ ☐ Gemini            │
   │                     │
   │ 📁 项目              │
   │ ☑️ 技术项目         │
   │ ☐ 产品项目          │
   │                     │
   │ 🏷️ 标签              │
   │ ☑️ React            │
   │ ☑️ Python           │
   │                     │
   │ 📅 时间              │
   │ ○ 今天              │
   │ ● 最近7天           │
   │ ○ 最近30天          │
   │ ○ 自定义范围        │
   └─────────────────────┘
   ```

3. **语义搜索** (V1.5):
   - 基于语义理解而非关键词
   - "找到所有关于性能优化的对话"
   - 按相关性排序

**搜索结果**:
```
搜索 "React 性能优化"
─────────────────────────

📄 如何优化 React 列表渲染
   ...使用 React.memo() 和 useMemo 可以有效优化性能...
   🤖 GPT-4  📁 技术  🏷️ React  🕐 2天前

📄 React 虚拟列表实现
   ...虚拟滚动是大列表性能优化的关键...
   🤖 Claude 3.5  📁 学习  🏷️ React  🕐 1周前

📄 性能分析工具使用
   ...React DevTools Profiler 可以帮你找到性能瓶颈...
   🤖 GPT-4  📁 技术  🏷️ React, 工具  🕐 3天前
```

##### Feature 9: 对话详情页

**页面结构**:
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回  |  [标题: 编辑]                    [⋮ 更多]    │
├─────────────────────────────────────────────────────────┤
│  [标签: React, 性能]  [项目: 技术]  [⭐ 收藏]           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  对话内容 (可滚动)                                      │
│  ...                                                    │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  📊 统计                                                │
│  消息数: 12  |  Token: 3.2k  |  成本: $0.0064          │
│  模型: GPT-4  |  创建: 2天前  |  更新: 1小时前          │
│                                                         │
│  🔗 相关对话 (V1.5)                                     │
│  📄 React 组件优化实践                                  │
│  📄 性能分析工具使用                                    │
└─────────────────────────────────────────────────────────┘
```

**操作菜单**:
- 📝 编辑标题
- 🏷️ 管理标签
- 📁 移动到项目
- 🔗 链接到对话 (V1.5)
- 💾 导出
- 🗑️ 删除
- 📤 分享到团队

#### 5.2.3 知识深度探索模块 🌟

##### Feature 10: 知识点标注

**功能描述**:
用户在阅读 AI 回复时，可以选中并标注任何不理解的知识点，追踪理解状态。

**核心交互**:

1. **选中文本标注**:
   - 在对话详情页，选中 AI 回复的任意文本
   - 右键菜单显示"标记为知识点"
   - 或使用快捷键 Cmd/Ctrl + K

2. **设置理解状态**:
   ```
   ┌─────────────────────────────────────┐
   │ 标记知识点: React.memo()            │
   ├─────────────────────────────────────┤
   │ 理解状态:                           │
   │ ● ❓ 不理解 (需要深入学习)         │
   │ ○ ⚠️ 部分理解 (有疑问)             │
   │ ○ ✅ 已掌握                        │
   ├─────────────────────────────────────┤
   │ 💬 添加疑问或笔记:                  │
   │ [memo 和 useMemo 有什么区别?]      │
   │                                     │
   ├─────────────────────────────────────┤
   │ [取消]  [保存]  [保存并深入探索]    │
   └─────────────────────────────────────┘
   ```

3. **知识点可视化**:
   - 标注的知识点在原文中高亮显示
   - 不同理解状态用不同颜色标识：
     - ❓ 红色：不理解
     - ⚠️ 黄色：部分理解
     - ✅ 绿色：已掌握
   - Hover 显示笔记预览

**数据模型**:
```typescript
interface KnowledgePoint {
  id: string;
  conversationId: string;
  messageId: string;

  // 标注内容
  selectedText: string;
  startOffset: number;
  endOffset: number;

  // 理解状态
  understandingLevel: 'not_understood' | 'partially_understood' | 'mastered';

  // 用户笔记
  notes?: string;
  questions?: string[];

  // 关联
  relatedConversations?: string[]; // 深度探索对话
  topicId?: string; // 所属主题知识库

  createdAt: Date;
  updatedAt: Date;
}
```

##### Feature 11: 深度探索对话

**功能描述**:
从标注的知识点一键发起深度探索对话，自动建立父子关联。

**核心流程**:

1. **发起探索**:
   - 在知识点详情面板点击"深入探索"
   - 或在标注时直接选择"保存并深入探索"
   - 系统自动生成探索 Prompt

2. **自动生成 Prompt**:
   ```
   系统自动构造的 Prompt 模板:

   我在学习【原始对话主题】时，遇到了一个不太理解的概念：

   【被标注的知识点文本】

   【用户添加的疑问】

   请帮我详细解释这个概念，包括：
   1. 基本定义和原理
   2. 使用场景和示例
   3. 与相关概念的对比（如果有）
   4. 常见误区和注意事项
   ```

3. **建立对话关联**:
   - 新对话自动标记为"探索对话"
   - 记录父对话 ID 和知识点 ID
   - 形成探索树结构

4. **可视化探索链**:
   ```
   探索链视图:
   ┌─────────────────────────────────────────────┐
   │ 📖 原始对话: React 性能优化                 │
   │                                             │
   │   └─ 📍 知识点: React.memo() ❓            │
   │      └─ 🔍 探索: React.memo 深度解析 ⚠️    │
   │         └─ 📍 知识点: HOC 模式 ❓          │
   │            └─ 🔍 探索: HOC vs Hooks ✅    │
   │                                             │
   │ [展开/折叠]  [查看图谱]                     │
   └─────────────────────────────────────────────┘
   ```

**数据模型**:
```typescript
interface ExplorationLink {
  id: string;
  parentConversationId: string;
  childConversationId: string;
  knowledgePointId: string;
  depth: number; // 探索深度（1, 2, 3...）
  createdAt: Date;
}
```

##### Feature 12: 知识点面板

**功能描述**:
侧边栏显示当前对话或主题的所有知识点，支持快速管理和导航。

**UI 设计**:
```
知识点侧边栏:
┌─────────────────────────────────────┐
│ 📍 知识点 (8)                       │
├─────────────────────────────────────┤
│ [全部] [不理解] [学习中] [已掌握]   │
├─────────────────────────────────────┤
│                                     │
│ ❓ React.memo()                     │
│    "memo 和 useMemo 有什么区别?"    │
│    🔍 1 个探索对话                  │
│    [深入探索] [标记已掌握]          │
│                                     │
│ ⚠️ useMemo 和 useCallback           │
│    "什么时候用 useMemo?"            │
│    🔍 2 个探索对话                  │
│                                     │
│ ✅ 虚拟列表                         │
│    已掌握 ✓                         │
│                                     │
├─────────────────────────────────────┤
│ 📊 理解进度: 37% (3/8)              │
│ [查看全部知识点]                    │
└─────────────────────────────────────┘
```

**核心功能**:
- 按理解状态筛选
- 一键跳转到原文位置
- 批量更新状态
- 导出知识点列表

##### Feature 13: 理解状态追踪

**功能描述**:
可视化追踪知识点的理解进度和演变过程。

**进度仪表盘**:
```
┌─────────────────────────────────────────────┐
│ 📊 知识理解进度                             │
├─────────────────────────────────────────────┤
│                                             │
│  ✅ 已掌握: ███████████░░░░░ 8 (66%)       │
│  ⚠️ 学习中: ████░░░░░░░░░░░░ 3 (25%)       │
│  ❓ 待学习: ██░░░░░░░░░░░░░░ 1 (8%)        │
│                                             │
│  总计: 12 个知识点                          │
│                                             │
├─────────────────────────────────────────────┤
│ 📈 学习轨迹                                 │
│                                             │
│  本周: +3 已掌握  +2 学习中                 │
│  上周: +2 已掌握  +1 学习中                 │
│                                             │
│  [查看详细统计]                             │
└─────────────────────────────────────────────┘
```

**时间线视图**:
```
知识点理解演变:
┌─────────────────────────────────────────┐
│ React.memo()                            │
│                                         │
│ 2025-10-20  ❓ 初次标注 (不理解)        │
│             "memo 和 useMemo 区别?"     │
│                                         │
│ 2025-10-21  🔍 深度探索                 │
│             创建探索对话                │
│                                         │
│ 2025-10-22  ⚠️ 更新状态 (部分理解)     │
│             "基本明白了，还需实践"      │
│                                         │
│ 2025-10-25  ✅ 标记已掌握               │
│             "实际项目中成功应用"        │
│                                         │
│ [查看探索对话] [添加笔记]               │
└─────────────────────────────────────────┘
```

#### 5.2.4 团队协作模块

##### Feature 10: 团队空间

**功能描述**:
创建团队工作空间，成员共享知识库。

**团队结构**:
```typescript
interface Team {
  id: string;
  name: string;
  avatar?: string;
  description?: string;

  members: TeamMember[];

  // 团队知识库
  sharedProjects: string[];
  sharedConversations: string[];

  settings: TeamSettings;

  createdAt: Date;
  createdBy: string;
}

interface TeamMember {
  userId: string;
  role: 'owner' | 'admin' | 'member';
  joinedAt: Date;
  permissions: Permission[];
}

interface TeamSettings {
  allowMemberInvite: boolean;
  defaultPermission: 'view' | 'comment' | 'edit';
  requireApproval: boolean;
}
```

**V1.0 限制**:
- 每个用户最多 1 个团队
- 每个团队最多 10 人
- 基础权限管理

##### Feature 11: 知识库共享

**共享方式**:

1. **项目级共享**:
   - 共享整个项目到团队
   - 项目内所有对话自动共享
   - 新增对话自动同步

2. **对话级共享**:
   - 单独分享某个对话
   - 生成分享链接
   - 设置权限（查看/评论/编辑）

**UI 交互**:
```
分享对话:
┌──────────────────────────┐
│ 📤 分享到                 │
├──────────────────────────┤
│ ● 团队空间               │
│ ○ 生成分享链接           │
│                          │
│ 权限:                    │
│ ○ 仅查看                 │
│ ● 可评论                 │
│ ○ 可编辑                 │
│                          │
│ [取消]  [分享]           │
└──────────────────────────┘
```

##### Feature 12: 成员管理

**功能**:
- 邀请成员（邮箱邀请）
- 管理成员角色
- 移除成员
- 查看成员活动

**角色权限**:

| 操作 | Owner | Admin | Member |
|------|-------|-------|--------|
| 查看团队对话 | ✅ | ✅ | ✅ |
| 分享对话到团队 | ✅ | ✅ | ✅ |
| 邀请成员 | ✅ | ✅ | ❌ |
| 管理成员 | ✅ | ✅ | ❌ |
| 删除团队 | ✅ | ❌ | ❌ |
| 修改团队设置 | ✅ | ✅ | ❌ |

#### 5.2.4 其他功能

##### Feature 13: 导出功能

**支持格式**:
1. **Markdown**: 完整对话（含代码块）
2. **JSON**: 结构化数据
3. **PDF**: 格式化文档（V1.5）

**导出选项**:
- 单个对话
- 整个项目
- 搜索结果
- 批量导出

**导出模板**:
```markdown
# 对话标题

**模型**: GPT-4
**日期**: 2025-10-26
**标签**: React, 性能
**项目**: 技术

---

## 对话内容

**用户**:
如何优化 React 性能?

**GPT-4**:
React 性能优化有以下几个方向:
...
```

##### Feature 14: 导入历史对话

**支持来源**:
- ChatGPT 官方导出 (JSON)
- Claude 对话 (手动复制)
- 其他格式 (CSV, TXT)

**导入流程**:
1. 选择文件
2. 预览数据
3. 映射字段
4. 选择目标项目
5. 确认导入

##### Feature 15: 云同步

**同步策略**:
- 本地优先（Local-First）
- 可选开启云同步
- 端到端加密
- 增量同步

**同步状态**:
```
☁️ 已同步 (2分钟前)
🔄 同步中...
⚠️ 同步失败 (点击重试)
📴 离线模式
```

**冲突解决**:
- 自动合并（timestamp 优先）
- 手动解决冲突
- 保留本地/云端版本

---

## 6. 用户故事

### 6.1 核心用户旅程

```
使用前                对话阶段              知识管理              团队协作
───────────────────────────────────────────────────────────────────────
安装应用         →   多模型对话      →    自动保存组织    →    分享到团队
配置 API Key    →   切换模型        →    搜索历史对话    →    协作讨论
创建项目         →   使用 Prompt     →    查看知识图谱    →    复用知识
```

### 6.2 详细用户故事（Epic）

#### Epic 1: 首次使用

**US-1.1 下载和安装**
```
作为 新用户
我想要 快速安装 Knowledge Studio
以便于 开始使用多模型 AI 对话

验收标准:
- [ ] 从官网下载安装包（Mac/Windows）
- [ ] 双击安装，无需复杂配置
- [ ] 首次启动显示欢迎界面
- [ ] 引导用户完成基础设置
```

**US-1.2 配置 API Key**
```
作为 新用户
我想要 简单配置各个 LLM 的 API Key
以便于 开始使用不同的模型

验收标准:
- [ ] 设置页面清晰展示支持的模型
- [ ] 每个模型有配置说明和获取链接
- [ ] API Key 加密存储
- [ ] 测试连接功能
- [ ] 至少配置一个模型即可使用
```

**US-1.3 创建第一个对话**
```
作为 新用户
我想要 快速开始第一次 AI 对话
以便于 体验产品核心功能

验收标准:
- [ ] 点击"新对话"按钮
- [ ] 选择模型（默认 GPT-4）
- [ ] 输入问题并获得回答
- [ ] 对话自动保存
- [ ] 显示使用提示（如何管理对话）
```

#### Epic 2: 日常对话

**US-2.1 多模型对话**
```
作为 用户
我想要 在不同模型间切换
以便于 对比不同模型的回答质量

验收标准:
- [ ] 对话界面顶部显示模型选择器
- [ ] 一键切换模型
- [ ] 切换后保留当前上下文
- [ ] 清晰标识每条消息使用的模型
- [ ] 支持快捷键切换 (Cmd/Ctrl + M)
```

**US-2.2 使用 Prompt 模板**
```
作为 用户
我想要 使用预设的 Prompt 模板
以便于 快速开始特定类型的对话

验收标准:
- [ ] 新对话时可选择模板
- [ ] 模板列表按分类展示
- [ ] 模板包含变量占位符
- [ ] 填写变量后自动发送
- [ ] 可保存常用模板
```

**US-2.3 管理对话上下文**
```
作为 用户
我想要 控制对话的上下文长度
以便于 优化成本和性能

验收标准:
- [ ] 设置保留的消息数量
- [ ] 实时显示 Token 计数
- [ ] 显示预估成本
- [ ] 手动选择包含的消息
- [ ] 超出限制时自动提醒
```

#### Epic 3: 知识管理

**US-3.1 组织对话到项目**
```
作为 用户
我想要 将对话分类到不同项目
以便于 系统化管理知识

验收标准:
- [ ] 创建多级项目/文件夹
- [ ] 拖拽对话到项目
- [ ] 对话详情页可选择项目
- [ ] 项目可设置颜色和图标
- [ ] 项目统计（对话数、更新时间）
```

**US-3.2 使用标签管理**
```
作为 用户
我想要 给对话打标签
以便于 多维度分类和检索

验收标准:
- [ ] 对话详情页添加标签
- [ ] 支持多个标签
- [ ] 标签自动补全
- [ ] 标签云显示（按频率）
- [ ] 点击标签筛选对话
```

**US-3.3 搜索历史对话**
```
作为 用户
我想要 快速找到历史对话
以便于 复用之前的知识

验收标准:
- [ ] 全局搜索框（快捷键 Cmd/Ctrl + K）
- [ ] 实时搜索建议
- [ ] 搜索结果高亮关键词
- [ ] 显示匹配片段
- [ ] 搜索响应时间 <200ms
```

**US-3.4 收藏重要对话**
```
作为 用户
我想要 标记重要对话为收藏
以便于 快速访问常用内容

验收标准:
- [ ] 对话列表显示星标按钮
- [ ] 一键添加/取消收藏
- [ ] 侧边栏"收藏"视图
- [ ] 收藏对话优先显示
```

#### Epic 4: 团队协作

**US-4.1 创建团队**
```
作为 团队管理员
我想要 创建团队工作空间
以便于 与成员共享知识

验收标准:
- [ ] 设置团队名称和描述
- [ ] 上传团队头像
- [ ] 配置团队设置
- [ ] 邀请首批成员
```

**US-4.2 邀请成员**
```
作为 团队管理员
我想要 邀请成员加入团队
以便于 扩大知识共享范围

验收标准:
- [ ] 通过邮箱邀请
- [ ] 生成邀请链接
- [ ] 设置成员角色
- [ ] 邀请状态追踪
- [ ] 成员接受邀请后自动加入
```

**US-4.3 分享对话到团队**
```
作为 团队成员
我想要 分享有价值的对话给团队
以便于 团队知识共享

验收标准:
- [ ] 对话详情页"分享"按钮
- [ ] 选择分享到团队空间
- [ ] 设置权限（查看/评论/编辑）
- [ ] 分享后团队成员可见
- [ ] 成员收到通知（可选）
```

**US-4.4 访问团队知识库**
```
作为 团队成员
我想要 浏览团队共享的对话
以便于 学习和复用团队知识

验收标准:
- [ ] 侧边栏显示"团队"入口
- [ ] 查看所有团队对话
- [ ] 按成员筛选
- [ ] 按项目/标签筛选
- [ ] 搜索团队知识库
```

#### Epic 5: 数据管理

**US-5.1 导出对话**
```
作为 用户
我想要 导出对话为不同格式
以便于 在其他工具中使用

验收标准:
- [ ] 单个对话导出（MD/JSON）
- [ ] 批量导出项目
- [ ] 导出包含完整内容
- [ ] 保留格式和代码块
- [ ] 导出成功提示
```

**US-5.2 导入历史对话**
```
作为 用户
我想要 导入 ChatGPT 的历史对话
以便于 迁移现有知识

验收标准:
- [ ] 支持 ChatGPT JSON 格式
- [ ] 上传文件并预览
- [ ] 选择导入目标项目
- [ ] 显示导入进度
- [ ] 导入完成后可查看
```

**US-5.3 开启云同步**
```
作为 用户
我想要 在多台设备间同步数据
以便于 随时随地访问知识库

验收标准:
- [ ] 设置页面开启云同步
- [ ] 创建账号或登录
- [ ] 首次同步（上传本地数据）
- [ ] 实时增量同步
- [ ] 显示同步状态
```

---

## 7. 非功能需求

### 7.1 性能要求

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| **应用启动时间** | <2s | 从点击到主界面可用 |
| **对话响应时间** | 实时流式输出 | 首字延迟 <500ms |
| **搜索响应时间** | <200ms | P95 延迟 |
| **对话加载时间** | <500ms | 完整对话渲染 |
| **内存占用** | <300MB | 空闲状态 |
| **存储效率** | 1万对话 <500MB | 数据库大小 |

### 7.2 安全要求

**数据安全**:
- API Key 使用系统 Keychain 加密存储（Mac/Windows）
- 本地数据库使用 SQLCipher 加密
- 云同步使用端到端加密（E2EE）
- 不收集用户对话内容

**隐私保护**:
- 遵循 GDPR/CCPA 规范
- 用户完全拥有数据
- 支持一键删除所有数据
- 不向第三方分享数据

### 7.3 可用性要求

**稳定性**:
- 应用崩溃率 <0.1%
- 对话自动保存（防止数据丢失）
- 异常退出后自动恢复

**兼容性**:
- macOS 12.0+
- Windows 10/11
- Linux (V1.5)

**离线能力**:
- 完全离线可用（除云同步）
- 本地模型支持（Ollama）
- 离线状态明确提示

### 7.4 可维护性要求

**代码质量**:
- TypeScript 严格模式
- ESLint + Prettier
- 单元测试覆盖率 >60%
- 关键功能集成测试

**文档**:
- 用户使用文档
- API 集成文档
- 开发者贡献指南

**日志和监控**:
- 错误日志本地记录
- 匿名崩溃报告（用户可选）
- 性能指标收集

---

## 8. 技术架构

### 8.1 技术栈

#### 桌面应用框架

**选择**: Tauri v2

**理由**:
- ✅ 原生性能（Rust 后端）
- ✅ 体积小（<10MB）
- ✅ 内存占用低
- ✅ 跨平台支持好
- ✅ 安全性高

**对比**:
| 框架 | 体积 | 内存 | 性能 | 安全性 |
|------|------|------|------|--------|
| Electron | ~150MB | 高 | 中 | 中 |
| Tauri | ~10MB | 低 | 高 | 高 |
| Flutter | ~20MB | 中 | 高 | 高 |

#### 前端技术栈

```
框架: React 18 + TypeScript
UI 库: shadcn/ui + Tailwind CSS
状态管理: Zustand
路由: React Router v6
Markdown: react-markdown + rehype
代码高亮: Prism.js / Shiki
图表: Recharts (知识图谱)
```

#### 后端技术栈（Tauri Rust）

```
数据库: SQLite + SQLCipher (加密)
ORM: SeaORM
LLM SDK:
  - openai-api-rs
  - anthropic-sdk-rust
  - google-generative-ai
HTTP 客户端: reqwest
加密: ring
序列化: serde
```

#### LLM 集成

**统一抽象层**:
```typescript
interface LLMProvider {
  chat(request: ChatRequest): AsyncIterator<ChatResponse>;
  models(): Promise<Model[]>;
  validateKey(apiKey: string): Promise<boolean>;
}

// 实现
class OpenAIProvider implements LLMProvider { ... }
class AnthropicProvider implements LLMProvider { ... }
class GoogleProvider implements LLMProvider { ... }
class OllamaProvider implements LLMProvider { ... }
```

### 8.2 数据模型

#### 核心数据表

**conversations** (对话):
```sql
CREATE TABLE conversations (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  model TEXT NOT NULL,
  project_id TEXT,
  user_id TEXT NOT NULL,
  team_id TEXT,
  is_favorite BOOLEAN DEFAULT FALSE,
  is_archived BOOLEAN DEFAULT FALSE,
  created_at INTEGER NOT NULL,
  updated_at INTEGER NOT NULL,

  -- 统计
  message_count INTEGER DEFAULT 0,
  total_tokens INTEGER DEFAULT 0,
  estimated_cost REAL DEFAULT 0,

  FOREIGN KEY (project_id) REFERENCES projects(id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (team_id) REFERENCES teams(id)
);

CREATE INDEX idx_conversations_project ON conversations(project_id);
CREATE INDEX idx_conversations_created ON conversations(created_at DESC);
CREATE INDEX idx_conversations_updated ON conversations(updated_at DESC);
CREATE FTS5 INDEX idx_conversations_search ON conversations(title);
```

**messages** (消息):
```sql
CREATE TABLE messages (
  id TEXT PRIMARY KEY,
  conversation_id TEXT NOT NULL,
  role TEXT NOT NULL CHECK(role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,
  model TEXT,
  tokens INTEGER,
  timestamp INTEGER NOT NULL,

  FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE
);

CREATE INDEX idx_messages_conversation ON messages(conversation_id);
CREATE FTS5 INDEX idx_messages_search ON messages(content);
```

**projects** (项目):
```sql
CREATE TABLE projects (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  parent_id TEXT,
  color TEXT,
  icon TEXT,
  user_id TEXT NOT NULL,
  team_id TEXT,
  created_at INTEGER NOT NULL,

  FOREIGN KEY (parent_id) REFERENCES projects(id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (team_id) REFERENCES teams(id)
);
```

**tags** (标签):
```sql
CREATE TABLE tags (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  color TEXT NOT NULL,
  user_id TEXT NOT NULL,
  team_id TEXT,
  usage_count INTEGER DEFAULT 0,

  UNIQUE(name, user_id, team_id)
);

CREATE TABLE conversation_tags (
  conversation_id TEXT NOT NULL,
  tag_id TEXT NOT NULL,

  PRIMARY KEY (conversation_id, tag_id),
  FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE,
  FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);
```

**teams** (团队):
```sql
CREATE TABLE teams (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  avatar TEXT,
  description TEXT,
  created_at INTEGER NOT NULL,
  created_by TEXT NOT NULL
);

CREATE TABLE team_members (
  team_id TEXT NOT NULL,
  user_id TEXT NOT NULL,
  role TEXT NOT NULL CHECK(role IN ('owner', 'admin', 'member')),
  joined_at INTEGER NOT NULL,

  PRIMARY KEY (team_id, user_id),
  FOREIGN KEY (team_id) REFERENCES teams(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 8.3 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        桌面应用 (Tauri)                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────────────────────────────────────┐     │
│  │              前端 (React + TypeScript)             │     │
│  │                                                    │     │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────┐    │     │
│  │  │ 对话界面  │  │ 知识管理  │  │ 团队协作     │    │     │
│  │  └──────────┘  └──────────┘  └──────────────┘    │     │
│  │         │             │              │            │     │
│  │  ┌──────┴─────────────┴──────────────┴─────┐     │     │
│  │  │          Zustand 状态管理               │     │     │
│  │  └────────────────┬────────────────────────┘     │     │
│  └───────────────────┼──────────────────────────────┘     │
│                      │ Tauri IPC                          │
│  ┌───────────────────┼──────────────────────────────┐     │
│  │              后端 (Rust)                          │     │
│  │                   │                               │     │
│  │  ┌────────────────┴────────────────┐             │     │
│  │  │       核心业务逻辑               │             │     │
│  │  │                                 │             │     │
│  │  │ - 对话管理  - API调度           │             │     │
│  │  │ - 数据持久化 - 云同步           │             │     │
│  │  └────────┬────────────────┬───────┘             │     │
│  │           │                │                     │     │
│  │  ┌────────┴──────┐  ┌──────┴──────────┐         │     │
│  │  │ SQLite +      │  │  LLM SDK        │         │     │
│  │  │ SQLCipher     │  │  集成层         │         │     │
│  │  └───────────────┘  └──────┬──────────┘         │     │
│  └────────────────────────────┼────────────────────┘     │
└────────────────────────────────┼──────────────────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │                         │
             ┌──────┴──────┐          ┌───────┴────────┐
             │ LLM APIs    │          │  云同步服务     │
             │             │          │  (可选)        │
             │ - OpenAI    │          │                │
             │ - Anthropic │          │  - 数据加密     │
             │ - Google    │          │  - 增量同步     │
             │ - Ollama    │          │                │
             └─────────────┘          └────────────────┘
```

### 8.4 关键技术决策

#### 为什么选择 Tauri？

| 因素 | Electron | Tauri |
|------|----------|-------|
| **体积** | ~150MB | ~10MB ✅ |
| **内存** | 200-500MB | 50-150MB ✅ |
| **性能** | V8引擎 | 原生 WebView ✅ |
| **安全** | 中等 | 高（Rust沙箱）✅ |
| **开发体验** | 成熟 | 快速发展 ⚠️ |

**结论**: Tauri 在性能、体积、安全性上优势明显，V2.0 已经足够成熟。

#### 为什么选择 SQLite？

- ✅ 本地优先架构
- ✅ 零配置，嵌入式
- ✅ 性能优秀（读写 >10k ops/s）
- ✅ 事务支持
- ✅ FTS5 全文搜索
- ✅ SQLCipher 加密支持

#### 为什么不用 Electron？

- ❌ 体积过大（150MB+）
- ❌ 内存占用高
- ❌ 安全性相对较弱
- ✅ Tauri 可以满足所有需求

---

## 9. 里程碑与路线图

### 9.1 开发里程碑

#### Phase 0: 准备阶段（Week 1-2）

**时间**: 2周

**目标**: 完成技术准备和原型验证

**任务清单**:
- [x] PRD 文档完成
- [ ] UI/UX 设计稿（Figma）
- [ ] 技术架构文档
- [ ] 数据库 Schema 设计
- [ ] Tauri + React 脚手架搭建
- [ ] LLM SDK 集成验证（OpenAI/Anthropic/Google）
- [ ] SQLite + SQLCipher 验证

**交付物**:
- 完整的设计稿
- 技术架构文档
- 可运行的 Demo（单个模型对话）

#### Phase 1: MVP 核心开发（Week 3-8）

**时间**: 6周

**Sprint 1 (Week 3-4): 基础设施**

任务:
- [ ] 项目结构搭建（Monorepo）
- [ ] Tauri 窗口和路由
- [ ] 数据库初始化和迁移
- [ ] 用户设置模块（API Key 管理）
- [ ] 基础 UI 组件库

**Sprint 2 (Week 5-6): AI 对话核心**

任务:
- [ ] 多模型集成（OpenAI, Anthropic, Google）
- [ ] 对话界面（输入、流式输出）
- [ ] 对话自动保存
- [ ] 模型切换
- [ ] 上下文管理
- [ ] Token 计数和成本估算

**Sprint 3 (Week 7-8): 知识管理**

任务:
- [ ] 项目/文件夹管理
- [ ] 标签系统
- [ ] 对话列表和详情页
- [ ] 全文搜索（FTS5）
- [ ] 高级筛选
- [ ] 收藏星标

#### Phase 2: 协作与完善（Week 9-10）

**时间**: 2周

**Sprint 4 (Week 9): 团队协作**

任务:
- [ ] 团队空间创建
- [ ] 成员邀请和管理
- [ ] 对话分享
- [ ] 权限控制
- [ ] 云同步基础（可选）

**Sprint 5 (Week 10): 功能完善**

任务:
- [ ] Prompt 模板管理
- [ ] 导出功能（MD/JSON）
- [ ] 导入 ChatGPT 历史
- [ ] 主题切换（亮/暗）
- [ ] 快捷键支持

#### Phase 3: 测试与发布（Week 11-12）

**时间**: 2周

**Week 11: 测试**

任务:
- [ ] 单元测试（核心逻辑）
- [ ] 集成测试（完整流程）
- [ ] 性能测试
- [ ] 跨平台测试（Mac/Windows）
- [ ] Bug 修复

**Week 12: 发布准备**

任务:
- [ ] 用户文档编写
- [ ] 发布页面和下载站
- [ ] 应用签名（Mac/Windows）
- [ ] 自动更新机制
- [ ] Beta 测试（50 用户）
- [ ] 收集反馈并优化

**V1.0 发布** 🎉

### 9.2 产品路线图

```
Q1 (Month 1-3)          Q2 (Month 4-6)         Q3 (Month 7-9)         Q4 (Month 10-12)
────────────────────────────────────────────────────────────────────────────────────
│ V1.0 MVP             │ V1.5 增强版           │ V2.0 Web版            │ V2.5 企业版
│                      │                      │                      │
├─ 多模型对话          ├─ 知识图谱            ├─ Web 平台            ├─ SSO 登录
├─ 基础知识管理       ├─ AI 自动摘要         ├─ 平台统一调用       ├─ 高级权限
├─ 本地存储           ├─ 语义搜索            ├─ 订阅制             ├─ 审计日志
├─ 团队协作(10人)     ├─ 对话分支            ├─ 更强协作           ├─ 私有部署
├─ Mac/Windows        ├─ 批量操作            ├─ API 开放           ├─ 企业定制
│                      ├─ Linux 支持          │                      │
│                      │                      │                      │
└─ 1,000 用户         └─ 5,000 用户          └─ 20,000 用户        └─ 50,000 用户
```

### 9.3 功能演进计划

**V1.0 (3个月)** - 桌面 MVP
- ✅ 多模型 AI 对话
- ✅ 基础知识管理
- ✅ 本地存储 + 云同步
- ✅ 小团队协作

**V1.5 (6个月)** - 增强版
- ✅ 知识图谱可视化
- ✅ AI 自动摘要和提取
- ✅ 语义搜索
- ✅ 对话分支和版本
- ✅ Linux 支持

**V2.0 (12个月)** - Web + SaaS
- ✅ Web 平台（跨设备）
- ✅ 平台统一调用 API
- ✅ 订阅制收费
- ✅ 更强的团队协作
- ✅ 开放 API

**V2.5 (18个月)** - 企业版
- ✅ SSO 单点登录
- ✅ 企业级权限管理
- ✅ 审计日志
- ✅ 私有部署
- ✅ 企业定制化

---

## 10. 成功指标

### 10.1 北极星指标

**周活跃知识采集量** (Weekly Active Knowledge Collection)

定义: 活跃用户每周保存并组织的有效对话数量

目标:
- V1.0 (3个月): 10 条/周/用户
- V1.5 (6个月): 20 条/周/用户
- V2.0 (12个月): 30 条/周/用户

### 10.2 关键指标体系

#### 用户获取指标

| 指标 | 3个月 | 6个月 | 12个月 |
|------|-------|-------|--------|
| 注册用户数 | 1,000 | 5,000 | 20,000 |
| 月活用户 (MAU) | 800 | 4,000 | 15,000 |
| 周活用户 (WAU) | 500 | 2,500 | 10,000 |
| DAU/MAU | >30% | >35% | >40% |

#### 用户参与指标

| 指标 | 3个月 | 6个月 | 12个月 |
|------|-------|-------|--------|
| 对话采集率 | 10/周 | 20/周 | 30/周 |
| 搜索使用率 | >60% | >70% | >80% |
| 标签使用率 | >50% | >60% | >70% |
| 团队协作率 | >20% | >30% | >40% |
| 平均会话时长 | 15分钟 | 20分钟 | 25分钟 |

#### 用户留存指标

| 指标 | 目标 |
|------|------|
| 次日留存率 | >50% |
| 7日留存率 | >35% |
| 30日留存率 | >25% |
| 90日留存率 | >15% |

#### 产品质量指标

| 指标 | 目标 |
|------|------|
| 应用崩溃率 | <0.1% |
| 对话保存成功率 | >99.9% |
| 搜索准确率 | >85% |
| 平均响应时间 | <200ms |
| NPS (净推荐值) | >40 |
| CSAT (满意度) | >4.2/5.0 |

### 10.3 商业化指标（V2.0）

| 指标 | 目标 |
|------|------|
| 付费用户数 | 2,000 |
| 付费转化率 | >15% |
| MRR (月经常性收入) | $20,000 |
| ARPU (每用户收入) | $10/月 |
| LTV (客户生命周期价值) | $300 |
| CAC (客户获取成本) | <$50 |
| LTV/CAC | >6 |

### 10.4 数据收集方法

**产品内埋点**:
- 工具: PostHog / Mixpanel
- 事件追踪:
  - 用户注册/登录
  - 对话创建（模型、Token数）
  - 对话保存到项目
  - 标签添加
  - 搜索查询
  - 团队协作操作

**定性研究**:
- 每周 3-5 个用户访谈
- 每月用户满意度调查
- 功能投票和反馈
- Discord 社区讨论

**性能监控**:
- 崩溃报告（Sentry）
- 性能指标（应用启动、搜索响应）
- 错误日志

---

## 11. 风险与依赖

### 11.1 技术风险

| 风险 | 影响 | 可能性 | 缓解措施 | 负责人 |
|------|------|-------|---------|--------|
| **LLM API 不稳定** | 高 | 中 | 1. 自动重试机制<br/>2. 降级策略<br/>3. 错误提示优化 | 后端负责人 |
| **Tauri 生态不成熟** | 中 | 低 | 1. 充分调研和验证<br/>2. 准备 Electron 降级方案<br/>3. 积极参与社区 | 技术负责人 |
| **跨平台兼容性** | 中 | 中 | 1. 早期多平台测试<br/>2. CI/CD 自动化测试<br/>3. Beta 测试覆盖多平台 | QA 负责人 |
| **数据库性能** | 中 | 低 | 1. 索引优化<br/>2. 分页加载<br/>3. 性能测试 | 后端负责人 |
| **云同步冲突** | 中 | 中 | 1. CRDT 算法<br/>2. 手动解决冲突<br/>3. 清晰的冲突提示 | 后端负责人 |

### 11.2 产品风险

| 风险 | 影响 | 可能性 | 缓解措施 | 负责人 |
|------|------|-------|---------|--------|
| **需求验证不足** | 高 | 中 | 1. 早期用户访谈（20+）<br/>2. Beta 测试快速迭代<br/>3. 社区反馈循环 | 产品经理 |
| **功能过于复杂** | 中 | 高 | 1. MVP 聚焦核心功能<br/>2. 用户引导和教程<br/>3. 渐进式功能展示 | 产品经理 |
| **竞品快速跟进** | 中 | 中 | 1. 快速迭代<br/>2. 差异化功能（知识图谱）<br/>3. 社区建设 | 产品经理 |
| **用户留存率低** | 高 | 中 | 1. 优化 Onboarding<br/>2. 邮件/通知激活<br/>3. 提供清晰价值 | 产品/运营 |

### 11.3 商业风险

| 风险 | 影响 | 可能性 | 缓解措施 | 负责人 |
|------|------|-------|---------|--------|
| **用户付费意愿低** | 高 | 中 | 1. V1.0 免费（验证需求）<br/>2. V2.0 提供清晰 ROI<br/>3. 企业版差异化定价 | 产品经理 |
| **API 成本过高** | 中 | 低 | 1. V1.0 用户自带 Key<br/>2. V2.0 批量采购折扣<br/>3. 成本监控和优化 | 技术/商务 |
| **获客成本高** | 中 | 中 | 1. 内容营销<br/>2. 社区运营<br/>3. 口碑传播 | 运营负责人 |

### 11.4 依赖管理

**外部依赖**:

1. **LLM API**:
   - OpenAI / Anthropic / Google
   - 风险: 价格调整、限额、服务中断
   - 应对: 多模型支持、用户自带 Key

2. **云服务** (V2.0):
   - AWS / GCP / Vercel
   - 风险: 成本增加、服务中断
   - 应对: 成本监控、多云准备

**内部依赖**:

1. **团队资源**:
   - 2 全栈工程师 + 1 设计师 + 1 产品经理
   - 风险: 人员流失、带宽不足
   - 应对: 文档化、模块化、外包备选

2. **用户增长**:
   - 依赖口碑传播和社区
   - 风险: 冷启动困难
   - 应对: 内容营销、早期用户激励

---

## 附录

### A. 竞品对比详细分析

| 产品 | 定位 | 优势 | 劣势 | 我们的机会 |
|------|------|------|------|-----------|
| **ChatGPT 官方** | AI 对话平台 | 模型最强、用户基数大 | 单一模型、知识管理弱、无团队协作 | ✅ 多模型整合<br/>✅ 知识管理专业化 |
| **Claude 官方** | AI 对话平台 | 长上下文、代码能力强 | 单一模型、知识管理弱 | 同上 |
| **Cherry Studio** | 多模型客户端 | 开源、多模型、免费 | 知识管理弱、无协作、功能简单 | ✅ 专业知识管理<br/>✅ 团队协作 |
| **Chatbox** | AI 客户端 | 本地优先、隐私好 | 功能简单、无协作 | 同上 |
| **Notion AI** | 文档+AI | 协作强、知识管理好 | AI 能力受限、无多模型、价格高 | ✅ 多模型<br/>✅ AI 原生设计 |
| **Obsidian** | 知识管理 | 双向链接、插件丰富 | AI 集成浅、学习成本高 | ✅ AI 原生设计<br/>✅ 自动化 |

### B. 用户访谈问题清单

**需求验证**:
1. 你现在使用哪些 AI 工具？频率如何？
2. 你在使用 AI 时遇到的最大痛点是什么？
3. 你如何管理和组织 AI 对话？
4. 你是否需要在多个 AI 模型间切换？为什么？
5. 你是否需要团队共享 AI 对话知识？

**功能优先级**:
1. 以下功能对你的重要性排序：
   - 多模型集成
   - 知识组织
   - 搜索检索
   - 知识图谱
   - 团队协作
2. 你愿意为这样的工具付费吗？可接受的价格？

**产品体验**:
1. 你更喜欢桌面应用还是 Web 应用？
2. 你是否需要离线使用？
3. 你是否愿意自己提供 API Key？

### C. 术语表

| 术语 | 定义 |
|------|------|
| **LLM** | Large Language Model，大语言模型 |
| **对话 (Conversation)** | 用户与 AI 的一次完整交互 |
| **上下文 (Context)** | 对话中保留的历史消息 |
| **Token** | LLM 处理文本的最小单位 |
| **Prompt** | 发送给 LLM 的指令或问题 |
| **流式输出 (Streaming)** | AI 逐字输出回答 |
| **项目 (Project)** | 组织对话的容器 |
| **知识图谱** | 可视化知识关联的图表 |
| **本地优先 (Local-First)** | 数据优先存储在本地 |
| **端到端加密 (E2EE)** | 数据在传输和存储时加密 |

### D. 参考资料

**竞品**:
- Cherry Studio: https://github.com/kangfenmao/cherry-studio
- Chatbox: https://chatboxai.app/
- ChatGPT: https://chat.openai.com/
- Claude: https://claude.ai/

**技术文档**:
- Tauri: https://tauri.app/
- SQLite FTS5: https://www.sqlite.org/fts5.html
- OpenAI API: https://platform.openai.com/docs/api-reference
- Anthropic API: https://docs.anthropic.com/

### E. 变更历史

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| v1.0 | 2025-10-26 | 初始版本（浏览器扩展方案） |
| v2.0 | 2025-10-26 | 重大调整：改为原生 AI 对话客户端 + 知识管理平台 |

---

## 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 产品负责人 | [待填写] | | |
| 技术负责人 | [待填写] | | |
| 设计负责人 | [待填写] | | |

---

**文档状态**: ✅ 完成
**下一步行动**:
1. UI/UX 设计
2. 技术架构详细设计
3. 数据库 Schema 实现
4. 项目脚手架搭建
